<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 1500">
  <defs>
    <style>
      .start-end { fill: #90EE90; stroke: #000; stroke-width: 2; }
      .process { fill: #87CEEB; stroke: #000; stroke-width: 2; }
      .io { fill: #FFD700; stroke: #000; stroke-width: 2; }
      .decision { fill: #FFA07A; stroke: #000; stroke-width: 2; }
      .text { font-family: Arial; font-size: 14px; text-anchor: middle; }
      .title { font-family: Arial; font-size: 18px; font-weight: bold; text-anchor: middle; }
      .cluster-label { font-family: Arial; font-size: 16px; font-weight: bold; fill: #333; }
      .arrow { fill: none; stroke: #000; stroke-width: 2; marker-end: url(#arrowhead); }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#000" />
    </marker>
  </defs>
  
  <!-- Заголовок -->
  <text x="400" y="30" class="title">Задание 2: Префиксная сумма (scan) на CUDA</text>
  
  <!-- Начало -->
  <ellipse cx="400" cy="80" rx="80" ry="30" class="start-end"/>
  <text x="400" y="85" class="text">Начало</text>
  
  <line x1="400" y1="110" x2="400" y2="140" class="arrow"/>
  
  <!-- Инициализация -->
  <rect x="300" y="140" width="200" height="60" rx="5" class="process"/>
  <text x="400" y="165" class="text">Инициализация массива</text>
  <text x="400" y="185" class="text">1,000,000 элементов</text>
  
  <line x1="400" y1="200" x2="400" y2="230" class="arrow"/>
  
  <!-- CPU блок -->
  <rect x="250" y="230" width="300" height="200" rx="5" fill="none" stroke="#666" stroke-width="2" stroke-dasharray="5,5"/>
  <text x="400" y="250" class="cluster-label">CPU Вычисления</text>
  
  <rect x="300" y="270" width="200" height="40" rx="5" class="process"/>
  <text x="400" y="295" class="text">Старт таймера CPU</text>
  
  <line x1="400" y1="310" x2="400" y2="330" class="arrow"/>
  
  <!-- Префиксная сумма CPU -->
  <rect x="300" y="330" width="200" height="60" rx="5" class="process"/>
  <text x="400" y="350" class="text">Префиксная сумма CPU</text>
  <text x="400" y="367" class="text">output[i] = </text>
  <text x="400" y="383" class="text">output[i-1] + input[i]</text>
  
  <line x1="400" y1="390" x2="400" y2="410" class="arrow"/>
  
  <rect x="300" y="410" width="200" height="40" rx="5" class="process"/>
  <text x="400" y="435" class="text">Стоп таймера CPU</text>
  
  <line x1="400" y1="450" x2="400" y2="480" class="arrow"/>
  
  <!-- GPU блок -->
  <rect x="250" y="480" width="300" height="600" rx="5" fill="none" stroke="#666" stroke-width="2" stroke-dasharray="5,5"/>
  <text x="400" y="500" class="cluster-label">GPU Вычисления с разделяемой памятью</text>
  
  <rect x="300" y="520" width="200" height="40" rx="5" class="process"/>
  <text x="400" y="545" class="text">cudaMalloc (GPU)</text>
  
  <line x1="400" y1="560" x2="400" y2="580" class="arrow"/>
  
  <path d="M 320 580 L 480 580 L 460 630 L 300 630 Z" class="io"/>
  <text x="390" y="600" class="text">cudaMemcpy</text>
  <text x="390" y="617" class="text">Host → Device</text>
  
  <line x1="380" y1="630" x2="380" y2="660" class="arrow"/>
  
  <!-- Конфигурация -->
  <rect x="300" y="660" width="200" height="60" rx="5" class="process"/>
  <text x="400" y="680" class="text">Настройка блоков,</text>
  <text x="400" y="697" class="text">потоков и размера</text>
  <text x="400" y="713" class="text">разделяемой памяти</text>
  
  <line x1="400" y1="720" x2="400" y2="740" class="arrow"/>
  
  <rect x="300" y="740" width="200" height="40" rx="5" class="process"/>
  <text x="400" y="765" class="text">Старт таймера GPU</text>
  
  <line x1="400" y1="780" x2="400" y2="800" class="arrow"/>
  
  <!-- Ядро с shared memory -->
  <rect x="280" y="800" width="240" height="160" rx="5" class="process"/>
  <text x="400" y="820" class="text" font-weight="bold">Запуск ядра prefixSum:</text>
  <text x="400" y="840" class="text">1. Загрузка в shared memory</text>
  <text x="400" y="857" class="text">2. __syncthreads()</text>
  <text x="400" y="874" class="text">3. Up-sweep фаза</text>
  <text x="400" y="891" class="text">4. Down-sweep фаза</text>
  <text x="400" y="908" class="text">5. Запись в global memory</text>
  <text x="400" y="925" class="text">6. __syncthreads() между</text>
  <text x="400" y="942" class="text">   каждым шагом</text>
  
  <line x1="400" y1="960" x2="400" y2="980" class="arrow"/>
  
  <rect x="300" y="980" width="200" height="40" rx="5" class="process"/>
  <text x="400" y="1005" class="text">cudaDeviceSynchronize()</text>
  
  <line x1="400" y1="1020" x2="400" y2="1040" class="arrow"/>
  
  <rect x="300" y="1040" width="200" height="40" rx="5" class="process"/>
  <text x="400" y="1065" class="text">Стоп таймера GPU</text>
  
  <line x1="400" y1="1080" x2="400" y2="1110" class="arrow"/>
  
  <path d="M 320 1110 L 480 1110 L 460 1160 L 300 1160 Z" class="io"/>
  <text x="390" y="1130" class="text">cudaMemcpy</text>
  <text x="390" y="1147" class="text">Device → Host</text>
  
  <line x1="380" y1="1160" x2="380" y2="1190" class="arrow"/>
  
  <!-- Проверка корректности (ромб) -->
  <path d="M 400 1190 L 500 1240 L 400 1290 L 300 1240 Z" class="decision"/>
  <text x="400" y="1235" class="text">Проверка</text>
  <text x="400" y="1252" class="text">корректности</text>
  
  <line x1="400" y1="1290" x2="400" y2="1320" class="arrow"/>
  
  <!-- Вывод результатов -->
  <path d="M 320 1320 L 480 1320 L 460 1380 L 300 1380 Z" class="io"/>
  <text x="390" y="1340" class="text">Вывод результатов:</text>
  <text x="390" y="1357" class="text">времени CPU vs GPU,</text>
  <text x="390" y="1373" class="text">проверка первых элементов</text>
  
  <line x1="380" y1="1380" x2="380" y2="1410" class="arrow"/>
  
  <rect x="300" y="1410" width="200" height="40" rx="5" class="process"/>
  <text x="400" y="1435" class="text">Освобождение памяти</text>
  
  <line x1="400" y1="1450" x2="400" y2="1480" class="arrow"/>
  
  <!-- Конец -->
  <ellipse cx="400" cy="1510" rx="80" ry="30" class="start-end"/>
  <text x="400" y="1515" class="text">Конец</text>
  
</svg>
