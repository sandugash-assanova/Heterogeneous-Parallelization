<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 1550">
  <defs>
    <style>
      .start-end { fill: #90EE90; stroke: #000; stroke-width: 2; }
      .process { fill: #87CEEB; stroke: #000; stroke-width: 2; }
      .io { fill: #FFD700; stroke: #000; stroke-width: 2; }
      .decision { fill: #FFA07A; stroke: #000; stroke-width: 2; }
      .parallel { fill: #DDA0DD; stroke: #000; stroke-width: 2; }
      .text { font-family: Arial; font-size: 13px; text-anchor: middle; }
      .title { font-family: Arial; font-size: 18px; font-weight: bold; text-anchor: middle; }
      .cluster-label { font-family: Arial; font-size: 15px; font-weight: bold; fill: #333; }
      .arrow { fill: none; stroke: #000; stroke-width: 2; marker-end: url(#arrowhead); }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#000" />
    </marker>
  </defs>
  
  <text x="500" y="30" class="title">Задание 4: Распределённая обработка с MPI</text>
  
  <!-- Начало -->
  <ellipse cx="500" cy="80" rx="80" ry="30" class="start-end"/>
  <text x="500" y="85" class="text">Начало</text>
  
  <line x1="500" y1="110" x2="500" y2="140" class="arrow"/>
  
  <!-- Инициализация MPI -->
  <rect x="400" y="140" width="200" height="40" rx="5" class="process"/>
  <text x="500" y="165" class="text">MPI_Init()</text>
  
  <line x1="500" y1="180" x2="500" y2="210" class="arrow"/>
  
  <!-- Получение размера и ранга -->
  <rect x="380" y="210" width="240" height="60" rx="5" class="process"/>
  <text x="500" y="230" class="text">MPI_Comm_size() → N процессов</text>
  <text x="500" y="247" class="text">MPI_Comm_rank() → мой ранг</text>
  <text x="500" y="263" class="text">localSize = totalSize / N</text>
  
  <line x1="500" y1="270" x2="500" y2="300" class="arrow"/>
  
  <!-- Выделение памяти -->
  <rect x="400" y="300" width="200" height="60" rx="5" class="process"/>
  <text x="500" y="320" class="text">Выделение памяти:</text>
  <text x="500" y="337" class="text">localInput[localSize]</text>
  <text x="500" y="353" class="text">localOutput[localSize]</text>
  
  <line x1="500" y1="360" x2="500" y2="390" class="arrow"/>
  
  <!-- Проверка ранга -->
  <path d="M 500 390 L 620 450 L 500 510 L 380 450 Z" class="decision"/>
  <text x="500" y="445" class="text">Ранг == 0?</text>
  <text x="500" y="462" class="text">(главный)</text>
  
  <!-- Да - главный процесс -->
  <line x1="620" y1="450" x2="750" y2="450" class="arrow"/>
  <text x="685" y="445" class="text">Да</text>
  
  <rect x="680" y="420" width="180" height="100" rx="5" class="process"/>
  <text x="770" y="445" class="text" font-weight="bold">Главный процесс:</text>
  <text x="770" y="465" class="text">создание массива</text>
  <text x="770" y="482" class="text">инициализация данных</text>
  <text x="770" y="499" class="text">вычисление sendCounts</text>
  <text x="770" y="515" class="text">и displacements</text>
  
  <line x1="770" y1="520" x2="770" y2="570" class="arrow"/>
  <line x1="770" y1="570" x2="500" y2="570" class="arrow"/>
  
  <!-- Нет - остальные процессы -->
  <line x1="500" y1="510" x2="500" y2="570" class="arrow"/>
  <text x="460" y="540" class="text">Нет</text>
  
  <!-- Барьер синхронизации -->
  <rect x="400" y="570" width="200" height="50" rx="5" class="process"/>
  <text x="500" y="590" class="text">MPI_Barrier()</text>
  <text x="500" y="607" class="text">синхронизация всех</text>
  
  <line x1="500" y1="620" x2="500" y2="650" class="arrow"/>
  
  <!-- Старт таймера -->
  <rect x="400" y="650" width="200" height="40" rx="5" class="process"/>
  <text x="500" y="675" class="text">Старт таймера (MPI_Wtime)</text>
  
  <line x1="500" y1="690" x2="500" y2="720" class="arrow"/>
  
  <!-- Scatterv -->
  <path d="M 390 720 L 610 720 L 590 800 L 370 800 Z" class="io"/>
  <text x="490" y="745" class="text" font-weight="bold">MPI_Scatterv()</text>
  <text x="490" y="762" class="text">Главный процесс раздаёт</text>
  <text x="490" y="779" class="text">каждому процессу</text>
  <text x="490" y="795" class="text">свою часть массива</text>
  
  <line x1="480" y1="800" x2="480" y2="830" class="arrow"/>
  
  <!-- Параллельная обработка -->
  <rect x="200" y="830" width="600" height="160" rx="5" fill="none" stroke="#666" stroke-width="3" stroke-dasharray="5,5"/>
  <text x="500" y="855" class="cluster-label">Параллельная обработка на всех процессах</text>
  
  <!-- Процессы -->
  <rect x="220" y="880" width="120" height="90" rx="5" class="parallel"/>
  <text x="280" y="905" class="text" font-weight="bold">Процесс 0</text>
  <text x="280" y="925" class="text">обрабатывает</text>
  <text x="280" y="942" class="text">свою часть</text>
  <text x="280" y="959" class="text">localOutput[i] =</text>
  
  <rect x="360" y="880" width="120" height="90" rx="5" class="parallel"/>
  <text x="420" y="905" class="text" font-weight="bold">Процесс 1</text>
  <text x="420" y="925" class="text">обрабатывает</text>
  <text x="420" y="942" class="text">свою часть</text>
  <text x="420" y="959" class="text">localInput[i]²</text>
  
  <rect x="500" y="880" width="120" height="90" rx="5" class="parallel"/>
  <text x="560" y="905" class="text" font-weight="bold">Процесс 2</text>
  <text x="560" y="925" class="text">обрабатывает</text>
  <text x="560" y="942" class="text">свою часть</text>
  
  <rect x="640" y="880" width="120" height="90" rx="5" class="parallel"/>
  <text x="700" y="905" class="text" font-weight="bold">Процесс N-1</text>
  <text x="700" y="925" class="text">обрабатывает</text>
  <text x="700" y="942" class="text">свою часть</text>
  
  <text x="500" y="975" class="text">... и так далее параллельно ...</text>
  
  <line x1="500" y1="1000" x2="500" y2="1030" class="arrow"/>
  
  <!-- Gatherv -->
  <path d="M 390 1030 L 610 1030 L 590 1110 L 370 1110 Z" class="io"/>
  <text x="490" y="1055" class="text" font-weight="bold">MPI_Gatherv()</text>
  <text x="490" y="1072" class="text">Все процессы отправляют</text>
  <text x="490" y="1089" class="text">свои результаты</text>
  <text x="490" y="1105" class="text">главному процессу</text>
  
  <line x1="480" y1="1110" x2="480" y2="1140" class="arrow"/>
  
  <!-- Барьер -->
  <rect x="400" y="1140" width="200" height="50" rx="5" class="process"/>
  <text x="500" y="1160" class="text">MPI_Barrier()</text>
  <text x="500" y="1177" class="text">синхронизация всех</text>
  
  <line x1="500" y1="1190" x2="500" y2="1220" class="arrow"/>
  
  <!-- Стоп таймера -->
  <rect x="400" y="1220" width="200" height="40" rx="5" class="process"/>
  <text x="500" y="1245" class="text">Стоп таймера (MPI_Wtime)</text>
  
  <line x1="500" y1="1260" x2="500" y2="1290" class="arrow"/>
  
  <!-- Проверка ранга для вывода -->
  <path d="M 500 1290 L 580 1330 L 500 1370 L 420 1330 Z" class="decision"/>
  <text x="500" y="1335" class="text">Ранг == 0?</text>
  
  <line x1="580" y1="1330" x2="700" y2="1330" class="arrow"/>
  <text x="640" y="1325" class="text">Да</text>
  
  <!-- Вывод результатов -->
  <path d="M 680 1310 L 820 1310 L 800 1380 L 660 1380 Z" class="io"/>
  <text x="740" y="1330" class="text">Вывод времени</text>
  <text x="740" y="1347" class="text">выполнения и</text>
  <text x="740" y="1363" class="text">проверка результата</text>
  
  <line x1="740" y1="1380" x2="740" y2="1410" class="arrow"/>
  <line x1="740" y1="1410" x2="500" y2="1410" class="arrow"/>
  
  <line x1="500" y1="1370" x2="500" y2="1410" class="arrow"/>
  <text x="460" y="1390" class="text">Нет</text>
  
  <!-- Освобождение памяти -->
  <rect x="400" y="1410" width="200" height="40" rx="5" class="process"/>
  <text x="500" y="1435" class="text">Освобождение памяти</text>
  
  <line x1="500" y1="1450" x2="500" y2="1480" class="arrow"/>
  
  <!-- Finalize -->
  <rect x="400" y="1480" width="200" height="40" rx="5" class="process"/>
  <text x="500" y="1505" class="text">MPI_Finalize()</text>
  
  <line x1="500" y1="1520" x2="500" y2="1550" class="arrow"/>
  
  <!-- Конец -->
  <ellipse cx="500" cy="1580" rx="80" ry="30" class="start-end"/>
  <text x="500" y="1585" class="text">Конец</text>
  
</svg>
